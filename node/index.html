<!DOCTYPE html>
<html>
<head>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.1.1/socket.io.js'></script>
  <script src="https://aframe.io/releases/1.1.0/aframe.min.js"></script>
  <script>
    const socket = io()
    let geometries = []
    let geometry = new THREE.Geometry()
    let entities = []
    socket.on('meshes', (data) => {
      for (let entity of entities) {
        entity.parentNode.removeChild(entity)
      }
      entities = []
      let scene = document.querySelector('a-scene')

      // console.log(data)
      let meshes = data.meshes
      // console.log(data)
      geometries = []
      for (let i = 0; i < meshes.length; i++) {
        let mesh = meshes[i]
        let vertices = mesh.vertices
        let geometry = new THREE.Geometry()
        for (let i = 0; i < vertices.length/3; i++) {
          let v0 = vertices[i*3]
          let v1 = vertices[i*3+1]
          let v2 = vertices[i*3+2]
          geometry.vertices.push(v0)
          geometry.vertices.push(v1)
          geometry.vertices.push(v2)
          geometry.faces.push(new THREE.Face3(i*3, i*3+1, i*3+2))
        }
        geometries.push(geometry)
      }
      // console.log(geometry)
      for (let i = 0; i < geometries.length; i++) {
        let geometry = geometries[i]
        let material = new THREE.MeshBasicMaterial({
          color: 'crimson',
          wireframe: true
        })
        let mesh = new THREE.Mesh(geometry, material)
        // let entity = document.getElementById(i)
        let entity = document.createElement('a-entity')
        entity.setObject3D('mesh', mesh)
        entities.push(entity)
        let parent = document.querySelector('#parent')
        parent.appendChild(entity)
        console.log(mesh)
        // scene.appendChild(entity)
      }
    })

    /*
    AFRAME.registerComponent('mesh-geometry', {
      tick: function() {
        for (let entity of entities) {
          entity.parentNode.removeChild(entity)
        }
        entities = []
        // console.log(geometries)
        for (let geometry of geometries) {
          var mesh = new THREE.Mesh(geometry)
          // console.log(mesh)
          let entity = document.createElement('a-entity')
          entity.setObject3D('mesh', mesh)
          entity.setAttribute('position', '0 0 -4')
          entity.setAttribute('material', 'color', 'crimson')
          this.el.sceneEl.appendChild(entity)
          entities.push(entity)
        }
      }
    })
    */
  </script>
</head>
<body>
  <a-scene background="color: #FAFAFA">
    <a-entity id="parent" position="0 0.5 -4"></a-entity>
    <a-plane static-body position="0 0 -4" rotation="-90 0 0" width="4" height="4" color="#7BC8A4" shadow></a-plane>
  </a-scene>
</body>
</html>
